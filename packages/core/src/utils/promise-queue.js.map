{"version":3,"file":"promise-queue.js","sourceRoot":"","sources":["promise-queue.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,2CAAyC;AAEzC;IAAA;QACU,iBAAY,GAAiC,EAAE,CAAA;IA0BzD,CAAC;IAxBQ,0BAAG,GAAV,UAAW,OAAqB;QAAhC,iBASC;QARC,IAAM,WAAW,GAAG,IAAA,eAAM,GAAE,CAAA;QAC5B,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,GAAG,OAAO,CAAA;QACxC,OAAO;aACJ,KAAK,CAAC,cAAO,CAAC,CAAC;aACf,OAAO,CAAC;YACP,OAAO,KAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAA;QACvC,CAAC,CAAC,CAAA;QACJ,OAAO,OAAO,CAAA;IAChB,CAAC;IAEY,2BAAI,GAAjB;;;;;;wBACM,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;wBAC3C,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAA;;;6BACrB,CAAA,MAAM,GAAG,CAAC,CAAA;wBACf,qBAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAA;;wBAA3B,SAA2B,CAAA;wBAC3B,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;wBAC3C,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAA;;;;;;KAE3B;IAED,sBAAW,gCAAM;aAAjB;YACE,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,MAAM,CAAA;QAC9C,CAAC;;;OAAA;IACH,mBAAC;AAAD,CAAC,AA3BD,IA2BC;AA3BY,oCAAY","sourcesContent":["import { uuidv7 } from '../vendor/uuidv7'\n\nexport class PromiseQueue {\n  private promiseByIds: Record<string, Promise<any>> = {}\n\n  public add(promise: Promise<any>): Promise<any> {\n    const promiseUUID = uuidv7()\n    this.promiseByIds[promiseUUID] = promise\n    promise\n      .catch(() => {})\n      .finally(() => {\n        delete this.promiseByIds[promiseUUID]\n      })\n    return promise\n  }\n\n  public async join(): Promise<void> {\n    let promises = Object.values(this.promiseByIds)\n    let length = promises.length\n    while (length > 0) {\n      await Promise.all(promises)\n      promises = Object.values(this.promiseByIds)\n      length = promises.length\n    }\n  }\n\n  public get length(): number {\n    return Object.keys(this.promiseByIds).length\n  }\n}\n"]}