{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import { FetchLike } from '../types'\n\nexport * from './bot-detection'\nexport * from './bucketed-rate-limiter'\nexport * from './number-utils'\nexport * from './string-utils'\nexport * from './type-utils'\nexport * from './promise-queue'\n\nexport const STRING_FORMAT = 'utf8'\n\nexport function assert(truthyValue: any, message: string): void {\n  if (!truthyValue || typeof truthyValue !== 'string' || isEmpty(truthyValue)) {\n    throw new Error(message)\n  }\n}\n\nfunction isEmpty(truthyValue: string): boolean {\n  if (truthyValue.trim().length === 0) {\n    return true\n  }\n  return false\n}\n\nexport function removeTrailingSlash(url: string): string {\n  return url?.replace(/\\/+$/, '')\n}\n\nexport interface RetriableOptions {\n  retryCount: number\n  retryDelay: number\n  retryCheck: (err: unknown) => boolean\n}\n\nexport async function retriable<T>(fn: () => Promise<T>, props: RetriableOptions): Promise<T> {\n  let lastError = null\n\n  for (let i = 0; i < props.retryCount + 1; i++) {\n    if (i > 0) {\n      // don't wait when it's the last try\n      await new Promise<void>((r) => setTimeout(r, props.retryDelay))\n    }\n\n    try {\n      const res = await fn()\n      return res\n    } catch (e) {\n      lastError = e\n      if (!props.retryCheck(e)) {\n        throw e\n      }\n    }\n  }\n\n  throw lastError\n}\n\nexport function currentTimestamp(): number {\n  return new Date().getTime()\n}\n\nexport function currentISOTime(): string {\n  return new Date().toISOString()\n}\n\nexport function safeSetTimeout(fn: () => void, timeout: number): any {\n  // NOTE: we use this so rarely that it is totally fine to do `safeSetTimeout(fn, 0)``\n  // rather than setImmediate.\n  const t = setTimeout(fn, timeout) as any\n  // We unref if available to prevent Node.js hanging on exit\n  t?.unref && t?.unref()\n  return t\n}\n\n// NOTE: We opt for this slightly imperfect check as the global \"Promise\" object can get mutated in certain environments\nexport const isPromise = (obj: any): obj is Promise<any> => {\n  return obj && typeof obj.then === 'function'\n}\n\nexport const isError = (x: unknown): x is Error => {\n  return x instanceof Error\n}\n\nexport function getFetch(): FetchLike | undefined {\n  return typeof fetch !== 'undefined' ? fetch : typeof globalThis.fetch !== 'undefined' ? globalThis.fetch : undefined\n}\n\nexport function allSettled<T>(\n  promises: (Promise<T> | null | undefined)[]\n): Promise<({ status: 'fulfilled'; value: T } | { status: 'rejected'; reason: any })[]> {\n  return Promise.all(\n    promises.map((p) =>\n      (p ?? Promise.resolve()).then(\n        (value: any) => ({ status: 'fulfilled' as const, value }),\n        (reason: any) => ({ status: 'rejected' as const, reason })\n      )\n    )\n  )\n}\n"]}