{"version":3,"file":"object-coercer.js","sourceRoot":"","sources":["object-coercer.ts"],"names":[],"mappings":";;;AAAA,iCAAmE;AACnE,kCAA8G;AAC9G,iCAAwD;AAIxD;IAAA;IAqEA,CAAC;IApEC,6BAAK,GAAL,UAAM,SAAkB;QACtB,OAAO,OAAO,SAAS,KAAK,QAAQ,IAAI,SAAS,KAAK,IAAI,CAAA;IAC5D,CAAC;IAED,8BAAM,GAAN,UAAO,SAAqB,EAAE,GAAoB;;QAChD,IAAM,aAAa,GAAG,IAAI,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAA;QAChE,IAAI,aAAa,EAAE,CAAC;YAClB,OAAO,GAAG,CAAC,KAAK,CAAC,aAAa,CAAC,CAAA;QACjC,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;gBAC7B,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;gBAC/B,KAAK,EAAE,MAAA,GAAG,CAAC,kBAAkB,0CAAE,KAAK;gBACpC,KAAK,EAAE,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO;gBACxE,SAAS,EAAE,IAAI;aAChB,CAAA;QACH,CAAC;IACH,CAAC;IAED,+BAAO,GAAP,UAAQ,GAA4B;QAClC,OAAO,IAAA,eAAO,EAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAA;IACtD,CAAC;IAED,gCAAQ,GAAR,UAAS,GAAW;QAClB,IAAI,MAAM,IAAI,GAAG,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YAClD,IAAI,OAAO,GAAG,WAAI,GAAG,CAAC,IAAI,4BAAyB,CAAA;YAEnD,IAAI,SAAS,IAAI,GAAG,IAAI,OAAO,GAAG,CAAC,OAAO,KAAK,QAAQ,EAAE,CAAC;gBACxD,OAAO,IAAI,0BAAmB,GAAG,CAAC,OAAO,MAAG,CAAA;YAC9C,CAAC;YAED,OAAO,OAAO,CAAA;QAChB,CAAC;aAAM,IAAI,SAAS,IAAI,GAAG,IAAI,OAAO,GAAG,CAAC,OAAO,KAAK,QAAQ,EAAE,CAAC;YAC/D,OAAO,GAAG,CAAC,OAAO,CAAA;QACpB,CAAC;QAED,IAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAA;QAC9C,IAAM,IAAI,GAAG,IAAA,sCAA8B,EAAC,GAAG,CAAC,CAAA;QAEhD,OAAO,UAAG,SAAS,IAAI,SAAS,KAAK,QAAQ,CAAC,CAAC,CAAC,WAAI,SAAS,MAAG,CAAC,CAAC,CAAC,QAAQ,+CAAqC,IAAI,CAAE,CAAA;IACxH,CAAC;IAEO,uCAAe,GAAvB,UAAwB,CAAU;QAChC,OAAO,IAAA,gBAAQ,EAAC,CAAC,CAAC,IAAI,CAAC,IAAA,qBAAa,EAAC,CAAC,CAAC,IAAI,sBAAc,CAAC,OAAO,CAAC,CAAkB,CAAC,IAAI,CAAC,CAAA;IAC5F,CAAC;IAED,8EAA8E;IACtE,kDAA0B,GAAlC,UAAmC,GAA4B;QAC7D,KAAK,IAAM,IAAI,IAAI,GAAG,EAAE,CAAC;YACvB,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,EAAE,CAAC;gBACpD,IAAM,KAAK,GAAG,GAAG,CAAC,IAAI,CAAC,CAAA;gBACvB,IAAI,IAAA,eAAO,EAAC,KAAK,CAAC,EAAE,CAAC;oBACnB,OAAO,KAAK,CAAA;gBACd,CAAC;YACH,CAAC;QACH,CAAC;QAED,OAAO,SAAS,CAAA;IAClB,CAAC;IAEO,0CAAkB,GAA1B,UAA2B,GAAY;QACrC,IAAI,CAAC;YACH,IAAM,SAAS,GAAmB,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,CAAA;YAC5D,OAAO,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAA;QAC3D,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,SAAS,CAAA;QAClB,CAAC;IACH,CAAC;IACH,oBAAC;AAAD,CAAC,AArED,IAqEC;AArEY,sCAAa","sourcesContent":["import { isEmptyString, isError, isEvent, isString } from '@/utils'\nimport { CoercingContext, ErrorTrackingCoercer, ExceptionLike, SeverityLevel, severityLevels } from '../types'\nimport { extractExceptionKeysForMessage } from './utils'\n\ntype ObjectLike = Record<string, unknown>\n\nexport class ObjectCoercer implements ErrorTrackingCoercer<ObjectLike> {\n  match(candidate: unknown): candidate is ObjectLike {\n    return typeof candidate === 'object' && candidate !== null\n  }\n\n  coerce(candidate: ObjectLike, ctx: CoercingContext): ExceptionLike | undefined {\n    const errorProperty = this.getErrorPropertyFromObject(candidate)\n    if (errorProperty) {\n      return ctx.apply(errorProperty)\n    } else {\n      return {\n        type: this.getType(candidate),\n        value: this.getValue(candidate),\n        stack: ctx.syntheticException?.stack,\n        level: this.isSeverityLevel(candidate.level) ? candidate.level : 'error',\n        synthetic: true,\n      }\n    }\n  }\n\n  getType(err: Record<string, unknown>): string {\n    return isEvent(err) ? err.constructor.name : 'Error'\n  }\n\n  getValue(err: object) {\n    if ('name' in err && typeof err.name === 'string') {\n      let message = `'${err.name}' captured as exception`\n\n      if ('message' in err && typeof err.message === 'string') {\n        message += ` with message: '${err.message}'`\n      }\n\n      return message\n    } else if ('message' in err && typeof err.message === 'string') {\n      return err.message\n    }\n\n    const className = this.getObjectClassName(err)\n    const keys = extractExceptionKeysForMessage(err)\n\n    return `${className && className !== 'Object' ? `'${className}'` : 'Object'} captured as exception with keys: ${keys}`\n  }\n\n  private isSeverityLevel(x: unknown): x is SeverityLevel {\n    return isString(x) && !isEmptyString(x) && severityLevels.indexOf(x as SeverityLevel) >= 0\n  }\n\n  /** If a plain object has a property that is an `Error`, return this error. */\n  private getErrorPropertyFromObject(obj: Record<string, unknown>): Error | undefined {\n    for (const prop in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n        const value = obj[prop]\n        if (isError(value)) {\n          return value\n        }\n      }\n    }\n\n    return undefined\n  }\n\n  private getObjectClassName(obj: unknown): string | undefined {\n    try {\n      const prototype: unknown | null = Object.getPrototypeOf(obj)\n      return prototype ? prototype.constructor.name : undefined\n    } catch (e) {\n      return undefined\n    }\n  }\n}\n"]}