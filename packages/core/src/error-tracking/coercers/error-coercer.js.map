{"version":3,"file":"error-coercer.js","sourceRoot":"","sources":["error-coercer.ts"],"names":[],"mappings":";;;AAAA,iCAAsC;AAGtC;IAAA;IAgCA,CAAC;IA/BC,4BAAK,GAAL,UAAM,GAAY;QAChB,OAAO,IAAA,oBAAY,EAAC,GAAG,CAAC,CAAA;IAC1B,CAAC;IAED,6BAAM,GAAN,UAAO,GAAU,EAAE,GAAoB;QACrC,OAAO;YACL,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC;YACvB,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,GAAG,CAAC;YAChC,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC;YACzB,KAAK,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS;YAClD,SAAS,EAAE,KAAK;SACjB,CAAA;IACH,CAAC;IAEO,8BAAO,GAAf,UAAgB,GAAU;QACxB,OAAO,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,WAAW,CAAC,IAAI,CAAA;IACzC,CAAC;IAEO,iCAAU,GAAlB,UAAmB,GAA2C,EAAE,IAAqB;QACnF,IAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAA;QAE3B,IAAI,OAAO,CAAC,KAAK,IAAI,OAAO,OAAO,CAAC,KAAK,CAAC,OAAO,KAAK,QAAQ,EAAE,CAAC;YAC/D,OAAO,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;QACtC,CAAC;QAED,OAAO,MAAM,CAAC,OAAO,CAAC,CAAA;IACxB,CAAC;IAEO,+BAAQ,GAAhB,UAAiB,GAAoC;QACnD,OAAO,GAAG,CAAC,UAAU,IAAI,GAAG,CAAC,KAAK,IAAI,SAAS,CAAA;IACjD,CAAC;IACH,mBAAC;AAAD,CAAC,AAhCD,IAgCC;AAhCY,oCAAY","sourcesContent":["import { isPlainError } from '@/utils'\nimport { CoercingContext, ErrorTrackingCoercer, ExceptionLike } from '../types'\n\nexport class ErrorCoercer implements ErrorTrackingCoercer<Error> {\n  match(err: unknown): err is Error {\n    return isPlainError(err)\n  }\n\n  coerce(err: Error, ctx: CoercingContext): ExceptionLike {\n    return {\n      type: this.getType(err),\n      value: this.getMessage(err, ctx),\n      stack: this.getStack(err),\n      cause: err.cause ? ctx.next(err.cause) : undefined,\n      synthetic: false,\n    }\n  }\n\n  private getType(err: Error): string {\n    return err.name || err.constructor.name\n  }\n\n  private getMessage(err: Error & { message: { error?: Error } }, _ctx: CoercingContext): string {\n    const message = err.message\n\n    if (message.error && typeof message.error.message === 'string') {\n      return String(message.error.message)\n    }\n\n    return String(message)\n  }\n\n  private getStack(err: Error & { stacktrace?: string }): string | undefined {\n    return err.stacktrace || err.stack || undefined\n  }\n}\n"]}