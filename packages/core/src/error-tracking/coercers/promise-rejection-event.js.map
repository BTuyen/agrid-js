{"version":3,"file":"promise-rejection-event.js","sourceRoot":"","sources":["promise-rejection-event.ts"],"names":[],"mappings":";;;AAAA,iCAAgD;AAGhD,WAAW;AACX;IAAA;IAgDA,CAAC;IA/CC,4CAAK,GAAL,UAAM,GAAY;QAChB,OAAO,IAAA,iBAAS,EAAC,GAAG,EAAE,uBAAuB,CAAC,CAAA;IAChD,CAAC;IAED,6CAAM,GAAN,UAAO,GAA0B,EAAE,GAAoB;;QACrD,IAAM,MAAM,GAAG,IAAI,CAAC,2BAA2B,CAAC,GAAG,CAAC,CAAA;QACpD,IAAI,IAAA,mBAAW,EAAC,MAAM,CAAC,EAAE,CAAC;YACxB,OAAO;gBACL,IAAI,EAAE,oBAAoB;gBAC1B,KAAK,EAAE,2DAAoD,MAAM,CAAC,MAAM,CAAC,CAAE;gBAC3E,KAAK,EAAE,MAAA,GAAG,CAAC,kBAAkB,0CAAE,KAAK;gBACpC,SAAS,EAAE,IAAI;aAChB,CAAA;QACH,CAAC;aAAM,CAAC;YACN,OAAO,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;QAC1B,CAAC;IACH,CAAC;IAEO,kEAA2B,GAAnC,UAAoC,KAAc;QAChD,IAAI,IAAA,mBAAW,EAAC,KAAK,CAAC,EAAE,CAAC;YACvB,OAAO,KAAK,CAAA;QACd,CAAC;QAED,2DAA2D;QAC3D,IAAI,CAAC;YAEH,0EAA0E;YAC1E,6EAA6E;YAC7E,IAAI,QAAQ,IAAK,KAAyB,EAAE,CAAC;gBAC3C,OAAQ,KAAyB,CAAC,MAAM,CAAA;YAC1C,CAAC;YAGD,8FAA8F;YAC9F,gFAAgF;YAChF,qFAAqF;YACrF,uEAAuE;YACvE,6DAA6D;YAC7D,IAAI,QAAQ,IAAK,KAA+B,IAAI,QAAQ,IAAK,KAA+B,CAAC,MAAM,EAAE,CAAC;gBACxG,OAAQ,KAA+B,CAAC,MAAM,CAAC,MAAM,CAAA;YACvD,CAAC;QACH,CAAC;QAAC,WAAM,CAAC;YACP,WAAW;QACb,CAAC;QAED,OAAO,KAAK,CAAA;IACd,CAAC;IACH,mCAAC;AAAD,CAAC,AAhDD,IAgDC;AAhDY,oEAA4B","sourcesContent":["import { isBuiltin, isPrimitive } from '@/utils'\nimport { CoercingContext, ErrorTrackingCoercer, ExceptionLike } from '../types'\n\n// Web only\nexport class PromiseRejectionEventCoercer implements ErrorTrackingCoercer<PromiseRejectionEvent> {\n  match(err: unknown): err is PromiseRejectionEvent {\n    return isBuiltin(err, 'PromiseRejectionEvent')\n  }\n\n  coerce(err: PromiseRejectionEvent, ctx: CoercingContext): ExceptionLike | undefined {\n    const reason = this.getUnhandledRejectionReason(err)\n    if (isPrimitive(reason)) {\n      return {\n        type: 'UnhandledRejection',\n        value: `Non-Error promise rejection captured with value: ${String(reason)}`,\n        stack: ctx.syntheticException?.stack,\n        synthetic: true,\n      }\n    } else {\n      return ctx.apply(reason)\n    }\n  }\n\n  private getUnhandledRejectionReason(error: unknown): unknown {\n    if (isPrimitive(error)) {\n      return error\n    }\n\n    // dig the object of the rejection out of known event types\n    try {\n      type ErrorWithReason = { reason: unknown }\n      // PromiseRejectionEvents store the object of the rejection under 'reason'\n      // see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n      if ('reason' in (error as ErrorWithReason)) {\n        return (error as ErrorWithReason).reason\n      }\n\n      type CustomEventWithDetail = { detail: { reason: unknown } }\n      // something, somewhere, (likely a browser extension) effectively casts PromiseRejectionEvents\n      // to CustomEvents, moving the `promise` and `reason` attributes of the PRE into\n      // the CustomEvent's `detail` attribute, since they're not part of CustomEvent's spec\n      // see https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent and\n      // https://github.com/getsentry/sentry-javascript/issues/2380\n      if ('detail' in (error as CustomEventWithDetail) && 'reason' in (error as CustomEventWithDetail).detail) {\n        return (error as CustomEventWithDetail).detail.reason\n      }\n    } catch {\n      // no-empty\n    }\n\n    return error\n  }\n}\n"]}